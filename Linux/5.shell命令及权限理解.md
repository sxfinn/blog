## Shell及权限理解

本文将介绍Shell是什么以及Linux中的权限。

可以想一想在我们使用计算机的过程中，我们使用图形化界面或者命令行与计算机进行交互，是直接与内核进行交互吗？如果是那内核的接口开放出来想一想会有哪些问题呢？

### shell命令以及运行原理

---

Linux严格意义上说的是一个操作系统，我们称之为“核心（kernel）“ ，但我们一般用户，不能直接使用kernel。而是通过kernel的“外壳”程序，也就是所谓的shell，来与kernel沟通。如何理解？为什么不能直接使用kernel？

从技术角度，Shell的最简单定义：**命令行解释器（command Interpreter）**主要包含：

> 将使用者的命令翻译给核心（kernel）处理。
>
> 内核处理命令后，将内核的处理结果翻译给使用者。

![image-20220820201826908](https://pic.xinsong.xyz/img/202208202018939.png)

**对比windows GUI**，我们操作windows 不是直接操作windows内核，而是通过图形接口，点击，从而完成我们的操作（比如进入D盘的操作，我们通常是双击D盘盘符.或者运行起来一个应用程序）。

Windows中，shell就是图形化界面操作，在Linux中，shell就是命令行操作。

shell 对于Linux，有相同的作用，主要是对我们的指令进行解析，解析指令给Linux内核。反馈结果在通过内核运行出结果返回给shell，通过shell解析返回给用户。

> 帮助理解：如果说你是一个闷骚且害羞的程序员，那shell就像媒婆，操作系统内核就是你们村头漂亮的且有让你心动的MM小花。你看上了小花，但是有不好意思直接表白，那就让你你家人找媒婆帮你提亲，所有的事情你都直接跟媒婆沟通，由媒婆转达你的意思给小花，而我们找到媒婆姓王，所以我们叫她王婆，它对应我们常使用的bash。

**作用**：

1. 降低OS的操作成本（最大意义）
2. 保护kernel，不将OS kernel直接暴露给用户。

**centos 7 常用的命令行解释器（shell）叫做bash**。

shell是这一类命令行解释器程序的总称，而bash是其中的一员。



### Linux权限的概念

---

**Linux下有两种用户：超级用户（root）、普通用户**。

* 超级用户（root）：可以再linux系统下做任何事情，不受限制
* 普通用户：在linux下做有限的事情，权限受到约束。
* 超级用户的命令提示符是“#”，普通用户的命令提示符是“$”。

查看当前用户：`whoami`

**切换用户**

**命令**：su [用户名]

**功能**：切换用户。

例如，要从root用户切换到普通用户user，则使用 su user。 要从普通用户user切换到root用户则使用 su root（root可以省略），此时系统会提示输入root用户密码的口令。



`su -`也可以切换至root，但是与`su root`却有区别，使用`su root`没有登录提示符，而`su -`有登陆提示符。

先来明白**两个概念**：

**登录shell和非登录shell**

登录shell：是需要用户名、密码登录后才能进入的shell（或者通过”–login”选项生成的shell）。

非登录shell：当然就不需要输入用户名和密码即可打开的Shell，例如：直接命令“bash”就是打开一个新的非登录shell，在Gnome或KDE中打开一个终端（terminal）窗口程序也是一个非登录shell。

**执行exit命令，退出一个shell（登录或非登录shell都可以退出）**

**执行logout命令，退出登录shell（不能退出非登录shell）。**

**看看下面**：

使用 su -

```shell
Last login: Sat Aug 20 20:33:41 2022 from 60.255.33.159
[sx@VM-4-9-centos ~]$ whoami
sx
[sx@VM-4-9-centos ~]$ su -# 登录root
Password: 
Last login: Sat Aug 20 20:34:07 CST 2022 on pts/0
[root@VM-4-9-centos ~]# whoami
root
[root@VM-4-9-centos ~]# logout
[sx@VM-4-9-centos ~]$ whoami
sx
```

使用 su root

```shell
Last login: Sat Aug 20 20:38:30 2022 from 60.255.33.159
[sx@VM-4-9-centos ~]$ whoami
sx
[sx@VM-4-9-centos ~]$ su root
Password: 
[root@VM-4-9-centos sx]# whoami
root
[root@VM-4-9-centos sx]# logout
bash: logout: not login shell: use `exit'
```

可以看到打开非登录shell时不会有登陆提示符，因此无法使用logout登出shell，而exit无论是登录shell还是非登录shell都可以退出。



**小Tips**：

1. root用户密码和普通用户密码不要设置为同一个！

2. 从root用户可以切换至任何用户，一定要防止root用户泄露！
3. 从普通用户切换至另一个用户，需要的是要切换的用户的密码。



### Linux权限管理

---

#### 文件访问者的分类（人）

* 文件和文件目录的所有者：u---User（中国平民 法律问题）

* 文件和文件目录的所有者所在的组的用户：g---Group（不多说）

* 其它用户：o---Others （外国人）

#### 文件类型和访问权限（事物属性）

**使用ls -l命令查看文件属性**

```shell
[sx@VM-4-9-centos test]$ ls
test.tgz  test.txt
[sx@VM-4-9-centos test]$ ls -l
total 1460
-rw-rw-r-- 1 sx sx     193 Aug 20 16:01 test.tgz
-rw-rw-r-- 1 sx sx 1488895 Aug 19 18:10 test.txt
```

Linux系统不是以文件名后缀区分文件类型的（但Linux上的有些软件会区分后缀），而是如下图：



![image-20220820191844855](https://pic.xinsong.xyz/img/202208201918952.png)



**文件类型**

```txt
d：文件夹：也叫目录文件
-：普通文件：文本文件，源代码，可执行程序，第三方静态库
l：软链接（类似Windows的快捷方式），链接文件
b：块设备文件（例如硬盘、光驱等）
p：管道文件
c：字符设备文件（例如屏幕等串口设备）
s：套接口文件
```

**基本权限**

i.读（r/4）：Read对文件而言，具有读取文件内容的权限；对目录来说，具有浏览该目录信息的权限

ii.写（w/2）：Write对文件而言，具有修改文件内容的权限；对目录来说具有删除移动目录内文件的权限

iii.执行（x/1）：execute对文件而言，具有执行文件的权限；对目录来说，具有进入目录的权限

iv.“—”表示不具有该项权限



















